{% extends "base.html" %}

{% block title %}ProTag - {{performer.performer_name}}{% endblock %}

{% block content %}
    <h1 align = "center">{{performer.performer_name}}</h1>
    {% if performer.songs %}
        <ul>
        <!-- alt = message when hovering over -->
        <!-- producer's image -->
        <img src="{{ performer.performer_img_url }}" width="250" height="200" alt="{{ performer.performer_name }}">
        <br>
        <br>
        {{ bio }}

<br>
<br>
<h3>Number of songs {{ performer.performer_name }} has created by producer</h3>
  <div class="melon-chart">
    <canvas id="donutChart"></canvas>
    <div id="donutLegend" class="chart-legend"></div>
  </div>

<!-- Chart 2 -->
  <script>
    const options = {
      responsive: true
    };

    // Make Donut Chart of percent of different types of Melons
    let ctx_donut = $("#donutChart").get(0).getContext("2d");

    $.get("/performer-frequency.json", function (data) {
      let myDonutChart = new Chart(ctx_donut, {
                                              type: 'doughnut',
                                              data: data,
                                              options: options
                                            });
      // $('#donutLegend').html(myDonutChart.generateLegend());
    });
</script>

      <h2>Albums</h2>
      <br>
      {% for year in album_years %}
              <h2>{{year}}</h2>
              {% for album in performer.albums %}
                  {% if album.album_release_date.strftime("%Y") == year %}
                      <h3><a href="/albums/{{ album.album_id }}"><i>{{ album.album_title }}</i></a></h3>
                      <img src="{{ album.cover_art_url }}" width="250" height="200" alt="{{ album.album_title }}">
                      {% for song in album.songs %} 
                          <li>
                          <a href="/songs/{{ song.song_id }}"><i>{{ song.song_title }}</i></a>
                          produced by
                            <!-- consider for loop & accumulator for better producer display -->
                          {% for producer in song.producers %} 
                              {% if loop.index == 1%}
                              <a href="/producers/{{ producer.producer_id }}">{{ producer.producer_name }}</a>
                              {% else %}
                              , <a href="/producers/{{ producer.producer_id }}">{{ producer.producer_name }}</a>
                              {% endif %}
                          {% endfor %}
                          <br>
                      {% endfor %}
                      <br>
                  {% endif %}
              {% endfor %}
              <br>
      {% endfor %}
      <br>
      <h2>Singles</h2>
      <br>
              {% for year in song_years %}
                <h2>{{year}}</h2>
                {% for song in performer.songs %}
                    {% if song.song_release_date.strftime("%Y") == year %} 
                          {% if not song.albums %}
                          <li>
                          <a href="/songs/{{ song.song_id }}">{{ song.song_title }}</a> produced by:
                            {% for producer in song.producers%}
                              {% if loop.index == 1 %}
                                <a href="/performers/{{ producer.producer_id }}">{{ producer.producer_name }}</a>
                              {% else %}
                                  , <a href="/performers/{{ producer.producer_id }}">{{ producer.producer_name }}</a>
                              {% endif %}
                            {% endfor %}
                          {% endif %}
                  {% endif %}
                {% endfor %}
              <br>
              <br>
        {% endfor %}
        <br>
    {% endif %}
{% endblock %}
<!-- add songs not on albums and songs/albums without release dates -->